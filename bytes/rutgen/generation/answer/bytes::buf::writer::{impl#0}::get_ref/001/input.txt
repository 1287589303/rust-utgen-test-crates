self.buf must be a valid BufMut instance with a non-negative remaining size, and can be modified before invoking get_ref for accurate capacity checks.
