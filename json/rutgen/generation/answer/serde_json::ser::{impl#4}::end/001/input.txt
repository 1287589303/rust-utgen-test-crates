state must equal State::First or State::Rest, and serializer.writer must be a valid writable object.
