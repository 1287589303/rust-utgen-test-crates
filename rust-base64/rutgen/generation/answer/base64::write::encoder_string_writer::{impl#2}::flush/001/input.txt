Buf must be within the range of valid UTF-8 encoded bytes, and engine must be properly initialized and configured; output buffer should not exceed BUF_SIZE and should allow for simultaneous calls to flush while maintaining state integrity across multiple invocations.
