state should be a valid State::Look with a non-null look, memory_extra should be less than the maximum size allowed for states, and the length of self.states should not exceed the maximum allowable state count before identifier allocation fails.
