n: 0, 1, or any positive integer; expr: valid Hir object satisfying minimum length conditions; greedy: true or false; results from self.c(expr) and self.c_exactly(expr, n - 1) must return Ok/Some; add_union()/add_union_reverse() must return Ok/Some; patch() must not error out.
