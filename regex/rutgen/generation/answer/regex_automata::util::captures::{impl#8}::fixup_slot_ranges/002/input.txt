self.slot_ranges must contain pairs of SmallIndex with start < end, pattern_len must be > 0, offsets must be within the bounds of SmallIndex::LIMIT, new_end < SmallIndex::LIMIT, and must not exceed u64 limits.
