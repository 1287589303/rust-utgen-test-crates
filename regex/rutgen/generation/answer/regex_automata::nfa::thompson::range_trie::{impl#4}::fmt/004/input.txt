self.states must be a non-empty Vec<State> containing valid states, without any entry at index FINAL.as_usize(), and the formatting output must be capable of producing an error when attempting to write.
