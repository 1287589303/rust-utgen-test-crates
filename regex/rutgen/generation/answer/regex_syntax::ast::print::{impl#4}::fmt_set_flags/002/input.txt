self.wtr must be a valid writer that supports write_str, and ast must be a valid ast::SetFlags structure with a Flags object containing at least one FlagsItem of type Negation or Flag, with appropriate handling to ensure fmt_flags can return an error on execution.
