new_capacity in the range [0, StateID::LIMIT]
