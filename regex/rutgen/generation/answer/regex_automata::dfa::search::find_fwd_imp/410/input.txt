haystack length > 3, pattern exists in haystack, prefilter with exactly one pattern, at > 0, nearest special state positioned correctly, earliest is true, input.span.start <= input.span.end
