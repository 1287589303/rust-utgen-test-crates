self.ranges must be non-empty with at least one ClassRange where start >= MIN and end == MAX, and another ClassRange that causes i in 1..drain_end to be false.
