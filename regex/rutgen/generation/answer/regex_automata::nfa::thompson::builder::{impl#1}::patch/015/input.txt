self.states must contain at least one CaptureEnd state, from and to must be valid StateIDs, memory_states must equal old_memory_states after patching, and there must be no size limit violation during patching.
